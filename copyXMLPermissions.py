# Farokh Confectioner
# Fabio Di Troia
# Gathers all the Anrdoid XML Permission files into a single folder

import sys
import os
import shutil

# args[1]: The directory containing all of the decompiled Android APK files
# args[2]: The directory to copy all of the xml permissions to
def main(args):
  MINIMUM_ARGS = 3
  if len(args) != MINIMUM_ARGS:
    print("Please enter correct number of args")
    exit(1)

  PERMISSION_DIR = args[1]
  COPY_DIR = args[2]
  copyPermissions(PERMISSION_DIR, COPY_DIR)

def copyPermissions(permission_dir, copy_dir):
  try:
    PERMISSION_FILE_NAME = "AndroidManifest.xml"
    for root, dirs, files in os.walk(permission_dir, topdown=False):
      for name in dirs:
        perm_file = os.path.join(root, name, PERMISSION_FILE_NAME)
        if(os.path.isfile(perm_file)):
          shutil.copyfile(perm_file, os.path.join(copy_dir, name + "_" + PERMISSION_FILE_NAME))
  except Exception as e:
    print(str(e))
    exit(1)
  print("Done")

if __name__ == "__main__":
  main(sys.argv)